<!DOCTYPE html>
<html lang="en">
<head>
    <title>xeogl Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

    <script src="../build/xeogl.js"></script>
    <script src="js/models/glTFModel.js"></script>

    <link href="css/styles.css" rel="stylesheet"/>

<body>

<div id="info" class="light">
    <h1>pick masking - using the "includeMeshes" option to restrict picking to a given list of <a href="../docs/classes/GLTFModel.html" target="_parent">Meshes</a></h1>
    <br>
    <ul>
        <li>ghost effect applied to a <a href="../docs/classes/GLTFModel.html" target="_parent">GLTFModel</a></li>
        <li>un-ghost <a href="../docs/classes/Mesh.html" target="_parent">Meshes</a> "gearbox#83.0" and "gearbox#81.0"
        </li>
        <li>attempt to pick and highlight Meshes on mouse-over</li>
        <li>using the <em>include</em> option, only allow "gearbox#83.0" and "gearbox#81.0" to be picked</li>
        <li>those meshes are then pickable <em>through</em> the other Meshes</li>
        <li>model by <a href="https://sketchfab.com/tflexcad" target="_parent">https://sketchfab.com/tflexcad</a></li>
    </ul>
</div>


<script>

    var scene = xeogl.scene;
    var camera = scene.camera;
    var input = scene.input;

    // Load glTF model

    var model = new xeogl.GLTFModel({
        id: "gearbox",
        src: "models/gltf/gearbox_conical/scene.gltf",
        lambertMaterials: true,
        edgeThreshold: 10,
        scale: [100, 100, 100]
    });

    model.on("loaded", function () {
        model.ghosted = true;
        scene.ghostMaterial.preset = "gamegrid";
        model.meshes["gearbox#83.0"].ghosted = false;
        model.meshes["gearbox#81.0"].ghosted = false;
    });

    // Position the camera

    camera.eye = [13.55, 8.24, 17.84];
    camera.look = [-2.54, -4.90, -0.10];
    camera.up = [-0.31, 0.87, -0.35];
    camera.zoom(-10);

    // Camera interaction

    new xeogl.CameraControl();

    // Highlight only the included Meshes on mouse over

    var lastEntity = null;

    input.on("mousemove", function (coords) {

        var hit = scene.pick({
            canvasPos: coords,
            includeMeshes: [
                "gearbox#83.0",
                "gearbox#81.0"
            ]
        });

        if (hit) {
            if (lastEntity) {
                if (lastEntity.id !== hit.mesh.id) {
                    lastEntity.highlighted = false;
                } else {
                    return;
                }
            }
            hit.mesh.highlighted = true;
            lastEntity = hit.mesh;

        } else if (lastEntity) {

            lastEntity.highlighted = false;
            lastEntity = null;
        }
    });


</script>
</body>
</html>