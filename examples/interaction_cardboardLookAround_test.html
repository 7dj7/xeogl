<!DOCTYPE html>
<html lang="en">
<head>
    <title>xeoEngine Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <script src="../build/xeoengine.js"></script>

    <script src="js/effects/stereo.js"></script>
    <script src="js/interaction/cardboardLookAroundEuler.js"></script>

    <link href="css/styles.css" rel="stylesheet"/>

<body>

<div id="infoLight">
    <a href="http://xeoengine.org" target="_home">xeoEngine</a><br><br>Google Cardboard viewing using a <a
        href="js/effects/stereo.js"
        target="_docs">XEO.Stereo</a> and a <a href="js/interaction/cardboardLookAround.js"
                                               target="_docs">XEO.CardboardLookAround</a>
</div>

<canvas id="deviceCanvas" width="400px" height="400px"></canvas>
&nbsp;&nbsp;
<canvas id="viewerCanvas" width="1200px" height="600px"></canvas>


<script>

    //--- Viewer scene --------------------------------------------------------------

    // A gearbox model loaded from glTF viewed in stereo with a Cardboard
    // fixed-position look-around interaction

    var viewerScene = new XEO.Scene({
        canvas: "viewerCanvas"
    });

    // Load glTF model
    //    var gearbox = new XEO.Model(viewerScene, {
    //        src: "models/gltf/buggy/buggy.gltf"
    //    });

    new XEO.Entity(viewerScene, {
        geometry: new XEO.BoxGeometry(viewerScene, {
            xSize: 20,
            ySize: 20,
            zSize: 20
        }),
        material: new XEO.PhongMaterial(viewerScene, {
            specular: [0.3, 0.3, 0.3],
            ambient: [0.5, 0.5, 0.6],
            diffuse: [0.7, 0.7, 0.8],
            shininess: 30,
            diffuseMap: new XEO.Texture(viewerScene, {
                src: "textures/diffuse/UVCheckerMap11-1024.png"
            })
        }),
        modes: new XEO.Modes(viewerScene, {
            backfaces: true
        })
    });

    // Create stereo effect
    new XEO.Stereo(viewerScene);

    // Drive Camera orientation with device orientation sensors
    new XEO.CardboardLookAround(viewerScene);

    // Simulates a "deviceorientation" event on the viewer scene

    window.orient = function (alpha, beta, gamma) {
        viewerScene.input.fire("deviceorientation", {
            alpha: alpha,
            beta: beta,
            gamma: gamma
        });
    };

    var alpha = 0;
    var beta = 90;
    var gamma = 0;

    var lastX;
    var lastY;
    var xDelta = 0;
    var yDelta = 0;
    var down = false;
    var over = false;
    var angle;
    var input = viewerScene.input;
    var sensitivity = 0.1;

    viewerScene.on("tick", function () {
        if (xDelta !== 0) {
            alpha += xDelta;
            xDelta = 0;
        }
        if (yDelta !== 0) {
            beta += yDelta;
            yDelta = 0;
        }
//        if (yDelta !== 0) {
//            gamma += yDelta;
//            yDelta = 0;
//        }
        window.orient(alpha, beta, gamma);
    });

    input.on("mousedown", function (e) {
        xDelta = 0;
        yDelta = 0;
        if (input.mouseDownLeft
                && !input.mouseDownRight
                && !input.keyDown[input.KEY_SHIFT]
                && !input.mouseDownMiddle) {
            down = true;
            lastX = e[0];
            lastY = e[1];
        } else {
            down = false;
        }
    });

    input.on("mouseup", function () {
        down = false;
        xDelta = 0;
        yDelta = 0;
    });

    input.on("mousemove", function (e) {
        if (!down) {
            return;
        }
        xDelta += (e[0] - lastX) * sensitivity;
        yDelta += (e[1] - lastY) * sensitivity;
        lastX = e[0];
        lastY = e[1];
    });

    //    //--- Device scene --------------------------------------------------------------
    //
    //    // A rotatable mobile device that fires "deviceOrientation" events
    //    // at the Viewer scene to simulate device orientation updates
    //
    //    var deviceScene = new XEO.Scene({
    //        canvas: "deviceCanvas"
    //    });
    //
    //    // Rotatable slab that represents the device
    //
    //    var device = new XEO.Entity(deviceScene, {
    //        geometry: new XEO.BoxGeometry(deviceScene, {
    //            xSize: 5,
    //            ySize: 1,
    //            zSize: 8
    //        }),
    //        transform: new XEO.Quaternion(deviceScene),
    //        material: new XEO.PhongMaterial(deviceScene, {
    //            diffuse: [0.5, 0.5, 0.8]
    //        })
    //    });
    //
    //    device.camera.view.eye = [0,0,-30];
    //
    //    // device.camera.view.eye = [0, 0, 25];
    //
    //    window.alphaInc = 0.1;
    //    window.betaInc = 0.0;
    //    window.gammaInc = 0;
    //
    //    var alpha = 0;
    //    var beta = 0;
    //    var gamma = 0;
    //
    //    device.transform.on("xyzw",
    //            function (xyzw) {
    //
    //                var math = XEO.math;
    //
    //                var mat = math.quaternionToMat4(xyzw, math.mat4());
    //
    //                var euler = math.mat4ToEuler(mat, "ZXY", math.vec4());
    //
    //                viewerScene.input.fire("deviceorientation", {
    //                    alpha: euler[0] / math.DEGTORAD, // Z
    //                    beta: euler[1] / math.DEGTORAD, // X
    //                    gamma: euler[2] / math.DEGTORAD // Y
    //                });
    //            });
    //
    //    // Orient the device for VR
    //
    //    device.transform.rotate([1, 0, 0, 90]);
    //    device.transform.rotate([0, 0, 1, 90]);
    //
    //    var r = [0, 1, 0, 0];
    //
    //    deviceScene.on("tick",
    //            function () {
    //                device.transform.rotate(r);
    //            });
    //
    //    window.rx = function (a) {
    //        r[0] = 1;
    //        r[1] = 0;
    //        r[2] = 0;
    //        r[3] = a * XEO.math.DEGTORAD;
    //    };
    //
    //    window.ry = function (a) {
    //        r[0] = 0;
    //        r[1] = 1;
    //        r[2] = 0;
    //        r[3] = a * XEO.math.DEGTORAD;
    //    };
    //
    //    window.rz = function (a) {
    //        r[0] = 0;
    //        r[1] = 0;
    //        r[2] = 1;
    //        r[3] = a * XEO.math.DEGTORAD;
    //    };
    //
    //    window.stop = function () {
    //        r = [0, 1, 0, 0];
    //    };
    //
    //    window.reset = function () {
    //        r = [0, 1, 0, 0];
    //    };


</script>
</body>
</html>