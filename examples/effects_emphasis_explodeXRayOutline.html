<!DOCTYPE html>
<html lang="en">
<head>
    <title>xeogl Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <script src="../build/xeogl.js"></script>

    <script src="js/models/OBJModel.js"></script>

    <link href="css/styles.css" rel="stylesheet"/>

<body>

<div id="info" class="dark">
    <h1><a href="../docs/classes/OBJModel.html" target="_parent">OBJModel</a> - explode, xray and outline effects </h1>
</div>

<script>

    // Custom lights

    xeogl.scene.lights.lights = [
        new xeogl.AmbientLight({
            color: [0.9, 0.9, 0.9]
        }),
        new xeogl.PointLight({
            pos: [-40, 30, 40],
            color: [1.0, 1.0, 1.0],
            space: "view"
        }),
        new xeogl.PointLight({
            pos: [40, 20, 20],
            color: [1.0, 1.0, 1.0],
            space: "view"
        }),
        new xeogl.PointLight({
            pos: [-20, 80, -80],
            color: [1.0, 1.0, 1.0],
            space: "view"
        })
    ];

    // Load model

    var model = new xeogl.OBJModel({
        id: "sportsCar",
        src: "models/obj/sportsCar/sportsCar.obj"
    });

    // Set up camera

    var view = xeogl.scene.camera.view;
    view.rotateEyeY(-30);
    view.rotateEyeX(15);

    var cameraControl = new xeogl.CameraControl();

    model.scene.on("tick", function () {
        model.scene.camera.view.rotateEyeY(-0.4);
    });

    // Emphasis effects

    model.on("loaded", function () {

        var cameraFlight = new xeogl.CameraFlightAnimation();
        cameraFlight.flyTo(model);

        explode();
        xray();
        outline();
    });

    function xray() {
        xrayEntities([
            "sportsCar#Body_Hatch_253",
            "sportsCar#Body_BodyShell_290",
            "sportsCar#Body_RDoorRot_RDoorPivot_DooR_199",
            "sportsCar#Body_BodyShell_264",
            "sportsCar#Body_BodyShell_289",
            "sportsCar#Body_LDoorRot_LDoorPivot_DoorL_199",
            "sportsCar#Body_219_BodyShell",
            "sportsCar#Wheels_WheelRR_Tires2_158",
            "sportsCar#Wheels_WheelRF_Tires_158",
            "sportsCar#Wheels_WheelLR_Tires2_158",
            "sportsCar#WheelLF_Wheels_Tires_158",
            "sportsCar#Body_BodyShell_Detail_228",
            "sportsCar#Chassis_265_UnderCover",
            "sportsCar#Body_InnerShell_312",
            "sportsCar#Body_RDoorRot_RDoorPivot_DooR_308",
            "sportsCar#Body_LDoorRot_LDoorPivot_DoorL_308",
            "sportsCar#Body_210_RDoorRot_RDoorPivot_DooR",
            "sportsCar#Body_210_LDoorRot_LDoorPivot_DoorL",
                "sportsCar#Body_Hatch_39",
                "sportsCar#Body_282_Tail001",
                "sportsCar#Body_InnerShell_311",
                "sportsCar#Body_BodyShell_Detail_14"
        ], 0.4);
    }

    function xrayEntities(ids, opacity) {
        for (var i = 0, len = ids.length; i < len; i++) {
            var id = ids [i];
            var entity = model.entities[id];
            entity.material.opacity = opacity;
            entity.modes.transparent = (opacity < 1.0);
        }
    }

    function explode() {

        moveEntities([
            "sportsCar#Body_Hatch_253",
            "sportsCar#Body_BodyShell_290",
            "sportsCar#Body_RDoorRot_RDoorPivot_DooR_199",
            "sportsCar#Body_BodyShell_264",
            "sportsCar#Body_BodyShell_289",
            "sportsCar#Body_LDoorRot_LDoorPivot_DoorL_199",
            "sportsCar#Body_219_BodyShell",
            "sportsCar#Body_BodyShell_Detail_228",
            "sportsCar#Chassis_265_UnderCover",
            "sportsCar#Body_InnerShell_312"
        ], [0, 1.3, 0]);

        moveEntities([
            "sportsCar#Body_RDoorRot_RDoorPivot_DooR_308"
        ], [-0.5, 0, 0]);

        moveEntities([
            "sportsCar#Body_LDoorRot_LDoorPivot_DoorL_308"
        ], [0.5, 0, 0]);

        moveEntities([
            "sportsCar#WheelLF_Wheels_Tires_158",
            "sportsCar#Wheels_WheelLR_Tires2_158"
        ], [0.5, 0, 0]);

        moveEntities([
            "sportsCar#WheelLF_Wheels_321_Tires",
            "sportsCar#Wheels_WheelLR_321_Tires2"
        ], [1.0, 0, 0]);

        moveEntities([
            "sportsCar#Wheels_WheelRF_Tires_158",
            "sportsCar#Wheels_WheelRR_Tires2_158"
        ], [-0.5, 0, 0]);

        moveEntities([
            "sportsCar#Wheels_WheelRF_321_Tires",
            "sportsCar#Wheels_WheelRR_321_Tires2"
        ], [-1.0, 0, 0]);
    }

    function moveEntities(ids, xyz) {
        for (var i = 0, len = ids.length; i < len; i++) {
            var id = ids [i];
            var entity = model.entities[id];
            entity.transform = new xeogl.Translate({
                xyz: xyz,
                parent: entity.transform
            });
        }
    }

    function outline() {
        outlineEntities([
            "sportsCar#Wheels_WheelRF_321_Tires",
            "sportsCar#Wheels_WheelRR_321_Tires2",
            "sportsCar#WheelLF_Wheels_321_Tires",
            "sportsCar#Wheels_WheelLR_321_Tires2"
        ]);
    }

    function outlineEntities(ids) {
        for (var i = 0, len = ids.length; i < len; i++) {
            var id = ids [i];
            var entity = model.entities[id];
            entity.modes.outline = true;
        }
    }

</script>
</body>
</html>