<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/core/clips.js - xeoengine</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../../files/logo.png" title="xeoengine"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AmbientLight.html">AmbientLight</a></li>
                                <li><a href="../classes/Camera.html">Camera</a></li>
                                <li><a href="../classes/Canvas.html">Canvas</a></li>
                                <li><a href="../classes/Clip.html">Clip</a></li>
                                <li><a href="../classes/Clips.html">Clips</a></li>
                                <li><a href="../classes/ColorBuf.html">ColorBuf</a></li>
                                <li><a href="../classes/ColorTarget.html">ColorTarget</a></li>
                                <li><a href="../classes/Component.html">Component</a></li>
                                <li><a href="../classes/Configs.html">Configs</a></li>
                                <li><a href="../classes/DepthBuf.html">DepthBuf</a></li>
                                <li><a href="../classes/DepthTarget.html">DepthTarget</a></li>
                                <li><a href="../classes/DirLight.html">DirLight</a></li>
                                <li><a href="../classes/Frustum.html">Frustum</a></li>
                                <li><a href="../classes/GameObject.html">GameObject</a></li>
                                <li><a href="../classes/Geometry.html">Geometry</a></li>
                                <li><a href="../classes/Input.html">Input</a></li>
                                <li><a href="../classes/Layer.html">Layer</a></li>
                                <li><a href="../classes/Lights.html">Lights</a></li>
                                <li><a href="../classes/Lookat.html">Lookat</a></li>
                                <li><a href="../classes/Material.html">Material</a></li>
                                <li><a href="../classes/math.html">math</a></li>
                                <li><a href="../classes/Modes.html">Modes</a></li>
                                <li><a href="../classes/MorphTargets.html">MorphTargets</a></li>
                                <li><a href="../classes/Ortho.html">Ortho</a></li>
                                <li><a href="../classes/Perspective.html">Perspective</a></li>
                                <li><a href="../classes/PointLight.html">PointLight</a></li>
                                <li><a href="../classes/Quaternion.html">Quaternion</a></li>
                                <li><a href="../classes/Reflect.html">Reflect</a></li>
                                <li><a href="../classes/Rotate.html">Rotate</a></li>
                                <li><a href="../classes/Scale.html">Scale</a></li>
                                <li><a href="../classes/Scene.html">Scene</a></li>
                                <li><a href="../classes/Shader.html">Shader</a></li>
                                <li><a href="../classes/ShaderParams.html">ShaderParams</a></li>
                                <li><a href="../classes/Stage.html">Stage</a></li>
                                <li><a href="../classes/Stats.html">Stats</a></li>
                                <li><a href="../classes/Task.html">Task</a></li>
                                <li><a href="../classes/Tasks.html">Tasks</a></li>
                                <li><a href="../classes/Texture.html">Texture</a></li>
                                <li><a href="../classes/Transform.html">Transform</a></li>
                                <li><a href="../classes/Translate.html">Translate</a></li>
                                <li><a href="../classes/Visibility.html">Visibility</a></li>
                                <li><a href="../classes/XEO.html">XEO</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/XEO.html">XEO</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/core/clips.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function () {

    &quot;use strict&quot;;


    /**
     A **Clips** is a group of arbitrarily-aligned {{#crossLink &quot;Clip&quot;}}Clip{{/crossLink}} planes that clip fragments of attached {{#crossLink &quot;GameObject&quot;}}GameObjects{{/crossLink}}.

     &lt;ul&gt;

     &lt;li&gt;Each {{#crossLink &quot;Clip&quot;}}Clip{{/crossLink}} is specified in World-space, as being perpendicular to a vector
     {{#crossLink &quot;Clip/dir:property&quot;}}{{/crossLink}} that emanates from the origin, offset at a
     distance {{#crossLink &quot;Clip/dist:property&quot;}}{{/crossLink}} along that vector. &lt;/li&gt;

     &lt;li&gt;You can move each {{#crossLink &quot;Clip&quot;}}Clip{{/crossLink}} back and forth along its vector by varying
     its {{#crossLink &quot;Clip/dist:property&quot;}}{{/crossLink}}.&lt;/li&gt;

     &lt;li&gt;Likewise, you can rotate each {{#crossLink &quot;Clip&quot;}}Clip{{/crossLink}} about the origin by rotating
     its {{#crossLink &quot;Clip/dir:property&quot;}}{{/crossLink}}.&lt;/li&gt;

     &lt;li&gt;Each {{#crossLink &quot;Clip&quot;}}Clip{{/crossLink}} is has a {{#crossLink &quot;Clip/mode:property&quot;}}{{/crossLink}}, which indicates whether it is disabled (&quot;disabled&quot;), discarding fragments that fall on the origin-side of the plane (&quot;inside&quot;), or clipping fragments that fall on the other side of the plane from the origin (&quot;outside&quot;).&lt;/li&gt;

     &lt;li&gt;You can update each {{#crossLink &quot;Clip&quot;}}Clip{{/crossLink}}&#x27;s {{#crossLink &quot;Clip/mode:property&quot;}}{{/crossLink}} to
     activate or deactivate it, or to switch which side it discards fragments from.&lt;/li&gt;

     &lt;/ul&gt;

     &lt;img src=&quot;http://www.gliffy.com/go/publish/image/6890347/L.png&quot;&gt;&lt;/img&gt;

     ## Example

     &lt;ul&gt;

     &lt;li&gt;In this example we have a {{#crossLink &quot;GameObject&quot;}}{{/crossLink}} that&#x27;s clipped by a {{#crossLink &quot;Clips&quot;}}{{/crossLink}}
     that contains two {{#crossLink &quot;Clip&quot;}}{{/crossLink}} planes.&lt;/li&gt;

     &lt;li&gt;The first {{#crossLink &quot;Clip&quot;}}{{/crossLink}} plane is on the
     positive diagonal, while the second is on the negative diagonal.&lt;/li&gt;

     &lt;li&gt;The {{#crossLink &quot;GameObject&quot;}}GameObject&#x27;s{{/crossLink}}
     {{#crossLink &quot;Geometry&quot;}}{{/crossLink}} is the default 2x2x2 box, and the planes will clip off two of the box&#x27;s corners.&lt;/li&gt;

     &lt;/ul&gt;

     &#x60;&#x60;&#x60;&#x60;javascript
     var scene = new XEO.Scene();

     // Clip plane on negative diagonal
     var clip1 = new XEO.Clip(scene, {
        dir: [-1.0, -1.0, -1.0], // Direction of Clip from World space origin
        dist: 2.0,               // Distance along direction vector
        mode: &quot;outside&quot;          // Clip fragments that fall beyond the plane
     });

     // Clip plane on positive diagonal
     var clip2 = new XEO.Clip(scene, {
        dir: [1.0, 1.0, 1.0],
        dist: 2.0,
        mode: &quot;outside&quot;
     });

     // Group the planes in a Clips
     var clips = new XEO.Clip(scene, {
        clips: [
            clip1,
            clip2
        ]
     });

     // Geometry defaults to a 2x2x2 box
     var geometry = new XEO.Geometry(scene);

     // Create an GameObject, which is a box sliced by our clip planes
     var object = new XEO.GameObject(scene, {
        clips: clips,
        geometry: geometry
     });
     &#x60;&#x60;&#x60;&#x60;

     @class Clips
     @module XEO
     @constructor
     @param [scene] {Scene} Parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}} - creates this Clips in the default
     {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}} when omitted.
     @param [cfg] {*} Configs
     @param [cfg.id] {String} Optional ID, unique among all components in the parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}},
     generated automatically when omitted.
     @param [cfg.meta] {String:Object} Optional map of user-defined metadata to attach to this Clips.
     @param [cfg.clips] {Array(String)|Array(XEO.Clip)} Array containing either IDs or instances of
     {{#crossLink &quot;Clip&quot;}}Clip{{/crossLink}} components within the parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}}.
     @extends Component
     */
    XEO.Clips = XEO.Component.extend({

        className: &quot;XEO.Clips&quot;,

        type: &quot;clips&quot;,

        _init: function (cfg) {

            this._clips = [];
            this._dirtySubs = [];
            this._destroyedSubs = [];

            this.clips = cfg.clips;
        },

        _props: {

            /**
             * The clipping planes contained within this Clips.
             *
             * Fires a {{#crossLink &quot;Clips/clips:event&quot;}}{{/crossLink}} event on change.
             *
             * @property clips
             * @default []
             * @type Array(XEO.Clip)
             */
            clips: {

                set: function (value) {

                    value = value || [];

                    var clip;

                    // Unsubscribe from events on old clips
                    for (var i = 0, len = this._clips.length; i &lt; len; i++) {
                        clip = this._clips[i];
                        clip.off(this._dirtySubs[i]);
                        clip.off(this._destroyedSubs[i]);
                    }

                    this._clips = [];
                    this._dirtySubs = [];
                    this._destroyedSubs = [];

                    var clips = [];
                    var self = this;

                    function clipDirty() {
                        self.fire(&quot;dirty&quot;, true);
                    }

                    function clipDestroyed() {
                        var id = this.id; // Clip ID
                        for (var i = 0, len = self._clips.length; i &lt; len; i++) {
                            if (self._clips[i].id === id) {
                                self._clips = self._clips.slice(i, i + 1);
                                self._dirtySubs = self._dirtySubs.slice(i, i + 1);
                                self._destroyedSubs = self._destroyedSubs.slice(i, i + 1);
                                self.fire(&quot;dirty&quot;, true);
                                self.fire(&quot;clips&quot;, self._clips);
                                return;
                            }
                        }
                    }

                    for (var i = 0, len = value.length; i &lt; len; i++) {

                        clip = value[i];

                        if (XEO._isString(clip)) {

                            // ID given for clip - find the clip component

                            var id = clip;
                            clip = this.components[id];
                            if (!clip) {
                                this.error(&quot;Clip not found for ID: &#x27;&quot; + id + &quot;&#x27;&quot;);
                                continue;
                            }
                        }

                        if (clip.type !== &quot;clip&quot;) {
                            this.error(&quot;Component is not a clip: &#x27;&quot; + clip.id + &quot;&#x27;&quot;);
                            continue;
                        }

                        this._clips.push(clip);

                        this._dirtySubs.push(clip.on(&quot;dirty&quot;, clipDirty));

                        this._destroyedSubs.push(clip.on(&quot;destroyed&quot;, clipDestroyed));

                        clips.push(clip);
                    }

                    /**
                     Fired whenever this Clips&#x27; {{#crossLink &quot;Clips/clips:property&quot;}}{{/crossLink}} property changes.
                     @event clips
                     @param value {Array of XEO.Clip} The property&#x27;s new value
                     */
                    this.fire(&quot;dirty&quot;, true);
                    this.fire(&quot;clips&quot;, this._clips);
                },

                get: function () {
                    return this._clips.slice(0, this._clips.length);
                }
            }
        },

        _compile: function () {
            var clips = [];
            for (var i = 0, len = this._clips.length; i &lt; len; i++) {
                clips.push(this._clips[i]._state);
            }
            var state = {
                type: &quot;clips&quot;,
                clips: clips,
                hash: this._makeHash(clips)
            };
            this._renderer.clips = state;
        },

        _makeHash: function (clips) {
            if (clips.length === 0) {
                return &quot;&quot;;
            }
            var parts = [];
            var clip;
            for (var i = 0, len = clips.length; i &lt; len; i++) {
                clip = clips[i];
                parts.push(clip.mode);
                if (clip.specular) {
                    parts.push(&quot;s&quot;);
                }
                if (clip.diffuse) {
                    parts.push(&quot;d&quot;);
                }
                parts.push((clip.space === &quot;world&quot;) ? &quot;w&quot; : &quot;v&quot;);
            }
            return parts.join(&quot;&quot;);
        },

        _getJSON: function () {
            var clipIds = [];
            for (var i = 0, len = this._clips.length; i &lt; len; i++) {
                clipIds.push(this._clips[i].id);
            }
            return {
                clips: clipIds
            };
        }
    });

})();
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
